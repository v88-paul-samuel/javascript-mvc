<!DOCTYPE html>
<html>
    <head>
        <title>The Wall</title>
        <link rel="stylesheet" type="text/css" href="/assets/styles/normalize.css" />
        <link rel="stylesheet" type="text/css" href="/assets/styles/walls.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="/assets/js/walls.js"></script>
    </head>
    <body>
        <header>
            <h1>CodingDojoWall</h1>
            <h4>Welcome <%= user.first_name %></h4>
            <a href="/logoff">logoff</a>
        </header>
        <div class="message_errors"></div>
        <form action="/postMessage" method="POST" id="post_message">
            <textarea name="message" placeholder="Insert Message Here"></textarea>
            <input type="submit" value="Post a message" />
        </form>
<% for(let content of wall_content){ 
        let message = content.message_object; %>
        <div class="message">
            <h3><%= message.sender_name %> - <%= message.created_at %></h3>
            <p><%= message.message %></p>
<% if(message.user_id === user.id){ %>
            <div>
                <div class="delete_errors"></div>
                <form action="/deleteMessage" method="POST" class="delete_message">
                    <input type="hidden" name="messages_id" value="<%= message.messages_id %>" />
                    <input type="submit" value="Delete Message" />
                </form>
            </div>
<% } %>
    <% for(let key in content.comment_object){ 
        let comment = content.comment_object[key] %>
            <div class="comment">
                <h3><%= comment.sender_name %> - <%= comment.created_at %></h3>
                <p><%= comment.comment %></p>
<% if(comment.user_id === user.id){ %>
                <div>
                    <div class="delete_errors"></div>
                    <form action="/deleteComment" method="POST" class="delete_comment">
                        <input type="hidden" name="comments_id" value="<%= comment.comments_id %>" />
                        <input type="submit" value="Delete Comment" />
                    </form>
                </div>
<% } %>
            </div>
    <% } %>
            <div class="comment_box">
                <div class="comment_errors"></div>
                <form action="/postComment" method="POST" class="post_comment">
                    <input type="hidden" name="message_id" value="<%=message.messages_id%>" />
                    <textarea name="comment" placeholder="Insert Comment Here"></textarea>
                    <input type="submit" value="Post a Comment" />
                </form>
            </div>
<% } %>
        </div>
    </body>
</html>